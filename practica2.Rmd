------------------------------------------------------------------------

title: "Practica2" output: html_document date: "2025-01-13"

# Instalar y cargar las librerías necesarias

```{r}
if (!require(httr)) install.packages("httr")
if (!require(httr2)) install.packages("httr2")
if (!require(XML)) install.packages("XML")
if (!require(dplyr)) install.packages("dplyr")
if (!require(ggplot2)) install.packages("ggplot2")
```

## Pregunta 1

```{r}
library(httr)
library(XML)
```

# Ejercicio 1

```{r}
url <- "https://www.mediawiki.org/wiki/MediaWiki";

html <- GET(url)

xml <- htmlParse(html)
```

# Ejercicio 2

```{r}
title <- xpathSApply(xml, "//title", xmlValue)
show(title)
```

# Ejercicio 3

```{r}
textos <- xpathSApply(xml, "//a", xmlValue)
links <- xpathSApply(xml, "//a", xmlGetAttr, "href")
valors_nuls <- sapply(links, is.null)
links[valors_nuls] <- NA
links <- unlist(links)
```

# Ejercicio 4

```{r}
taula_links <- data.frame( Textos = textos, Links = links)

taula_links$es_absoluta <- grepl("^http", taula_links$Links)

taula_links$full_link <- ifelse(taula_links$es_absoluta == FALSE, paste0("https://www.mediawiki.org", taula_links$Links), taula_links$Links )

temp_taula <- taula_links %>% count(full_link)

taula_links <- left_join(taula_links, temp_taula, by = "full_link")
rm(temp_taula)

```

#Ejercicio 5

```{r}

status_link <- function(link) {
  Sys.sleep(0.2)
  response <- GET(link)
  status_code(response)
}

status_link_vector <- Vectorize(status_link)

taula_links <- taula_links %>%
  mutate(status = status_link_vector(taula_links$full_link))



```

## Pregunta 2

# Ejercicio 1

```{r}

taula_links <- taula_links %>%
  mutate(type = ifelse(grepl("^http", Links), "Absolute", "Relative"))

url_counts <- taula_links %>%
  group_by(type, Links) %>%
  summarise(count = n(), .groups = "drop")

ggplot(url_counts, aes(x = Links, y = count, fill = type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Frecuencia de URLs Absolutas y Relativas",
    x = "URLs",
    y = "Frecuencia",
    fill = "Tipo de URL"
  ) 


```

```{r}
library(ggplot2)

# Define una función auxiliar `get_domain` que toma una URL y devuelve solo el dominio
get_domain <- function(url) {
  return(gsub("^(https?://(www\\.)?)|([^/]+/.*)$", "\\3", url))
}

# Crea una nueva columna `dominio` a partir de la columna `full_link` para extraer solo el dominio
taula_links$dominio <- sapply(taula_links$full_link, get_domain)

# Crea un dataframe `total_links` con las columnas `dominio` y `n`, y agrupa por `dominio` y suma los valores de `n`
total_links <- aggregate(n ~ dominio, taula_links, sum)

# Crea un dataframe `enlaces_dentro` filtrando `total_links` para cuando `dominio` sea 'www.mediawiki.org'
enlaces_dentro <- total_links[total_links$dominio == 'www.mediawiki.org',]

# Crea un dataframe `enlaces_fuera` filtrando `total_links` para cuando `dominio` no sea 'www.mediawiki.org'
enlaces_fuera <- total_links[total_links$dominio != 'www.mediawiki.org',]

# Crea un gráfico de barras con la suma de enlaces que apuntan a otros dominios o servicios (distinto a 'www.mediawiki.org') vs. la suma de los otros enlaces
ggplot(data.frame(
  'Tipo de enlace' = c('Enlaces dentro', 'Enlaces fuera'),
  'Número de enlaces' = c(enlaces_dentro$n, sum(enlaces_fuera$n))
)) +
geom_bar(aes(x = 'Tipo de enlace', y = 'Número de enlaces'), stat = "identity") +
labs(
  title = 'Número de enlaces dentro vs fuera del dominio',
  x = 'Tipo de enlace',
  y = 'Número de enlaces'
)

# Crea un gráfico de barras que muestre los dominios a los que apuntan los enlaces externos, excluyendo 'www.mediawiki.org'
ggplot(enlaces_fuera, aes(x = dominio, y = n)) +
geom_bar(stat = "identity") +
labs(
  title = 'Número de enlaces por dominio externo',
  x = 'Dominio',
  y = 'Número de enlaces'
)

# Crea un gráfico de barras que compare el número de enlaces internos (dentro del dominio) con el número de enlaces externos (fuera del dominio)
ggplot(data.frame(
  'Tipo de enlace' = c('Enlaces internos', 'Enlaces externos'),
  'Número de enlaces' = c(enlaces_dentro$n, sum(enlaces_fuera$n))
)) +
geom_bar(aes(x = 'Tipo de enlace', y = 'Número de enlaces'), stat = "identity") +
labs(
  title = 'Comparación de enlaces internos y externos',
  x = 'Tipo de enlace',
  y = 'Número de enlaces'
)
```


```{r}

```



