------------------------------------------------------------------------

title: "Practica2" output: html_document date: "2025-01-13"

# Instalar y cargar las librer√≠as necesarias

```{r}
if (!require(httr)) install.packages("httr")
if (!require(XML)) install.packages("XML")
if (!require(dplyr)) install.packages("dplyr")
if (!require(ggplot2)) install.packages("ggplot2")
```

## Pregunta 1

```{r}
library(httr)
library(XML)
```

# Ejercicio 1

```{r}
url <- "https://www.mediawiki.org/wiki/MediaWiki";

html <- GET(url)

xml <- htmlParse(html)
```

# Ejercicio 2

```{r}
title <- xpathSApply(xml, "//title", xmlValue)
show(title)
```

# Ejercicio 3

```{r}
textos <- xpathSApply(xml, "//a", xmlValue)
links <- xpathSApply(xml, "//a", xmlGetAttr, "href")
valors_nuls <- sapply(links, is.null)
links[valors_nuls] <- NA
links <- unlist(links)
```

# Ejercicio 4

```{r}
taula_links <- data.frame( Textos = textos, Links = links)

taula_links$es_absoluta <- grepl("^http", taula_links$Links)

taula_links$full_link <- ifelse(taula_links$es_absoluta == FALSE, paste0("https://www.mediawiki.org", taula_links$Links), taula_links$Links )

temp_taula <- taula_links %>% count(full_link)

taula_links <- left_join(taula_links, temp_taula, by = "full_link")
rm(temp_taula)

```

#Ejercicio 5

```{r}

library(httr2)

status_link <- function(link) {
  Sys.sleep(0.2)
  response <- GET(link)
  status_code(response)
}

status_link_vector <- Vectorize(status_link)

taula_links <- taula_links %>%
  mutate(status = status_link_vector(taula_links$full_link))



```

## Pregunta 2

```{r}
library(ggplot2)
```

# Ejercicio 1

```{r}

taula_links <- taula_links %>%
  mutate(type = ifelse(grepl("^http", Links), "Absolute", "Relative"))

url_counts <- taula_links %>%
  group_by(type, Links) %>%
  summarise(count = n(), .groups = "drop")

ggplot(url_counts, aes(x = Links, y = count, fill = type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Frecuencia de URLs Absolutas y Relativas",
    x = "URLs",
    y = "Frecuencia",
    fill = "Tipo de URL"
  ) 


```
